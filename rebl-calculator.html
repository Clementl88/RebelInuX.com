<!DOCTYPE html>
<html lang="en" translate="no" class="calculator-page">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Enhanced RebelInuX Sustainable Reward Calculator - Calculate $REBL rewards using the new sustainable formula with Gamma Scale Factor" />
  <meta name="keywords" content="RebelInuX calculator, $REBL rewards, epoch calculator, sustainable formula, gamma scale factor, crypto calculator" />
  <meta property="og:title" content="Enhanced RebelInuX Sustainable Reward Calculator" />
  <meta property="og:image" content="https://rebelinux.fun/images/Logo_REBL.svg" />
  <meta property="og:description" content="Calculate your $REBL rewards using the sustainable formula with Gamma Scale Factor (Œ≥) simulation" />
  <meta property="og:url" content="https://rebelinux.fun/rebl-calculator.html" />
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="RebelInuX">
  <meta name="twitter:title" content="Enhanced RebelInuX Sustainable Reward Calculator">
  <meta name="twitter:description" content="Calculate your $REBL rewards using the sustainable formula with Gamma Scale Factor (Œ≥) simulation">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://rebelinux.fun/images/Logo_REBL.svg">
  
  <!-- Favicons -->
  <link rel="icon" href="images/Logo_REBL.svg">
  <link rel="apple-touch-icon" href="images/Logo_REBL.svg">
  <title>Enhanced RebelInuX Sustainable Reward Calculator</title>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Chart.js with enhancements -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

  <!-- CSS Files -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/header-footer.css">
  <link rel="stylesheet" href="css/rebl-calculator.css">
  
  <!-- PWA Support -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1a1a1a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
  <!-- Loading Animation -->
  <div class="loader" id="loader">
    <div class="loader-spinner"></div>
    <div class="loader-text">Loading Enhanced Calculator...</div>
  </div>
  
  <!-- Back to Top Button -->
  <div class="back-to-top" id="backToTop">
    <i class="fas fa-arrow-up"></i>
  </div>
  
  <!-- Header will be inserted here by JavaScript -->
  <div id="header-container"></div>
  
  <main>
    <!-- Enhanced Hero Section -->
    <section class="page-hero page-hero--calculator">
      <div class="container">
        <div class="hero-content">
          <h1>ENHANCED SUSTAINABLE REWARD CALCULATOR</h1>
          <p class="text-lead">
            Calculate your $REBL rewards using the new sustainable formula with Gamma Scale Factor (Œ≥) simulation. 
            Plan your strategy based on participation levels with advanced analytics and projections!
          </p>
          <div class="hero-stats">
            <div class="stat-item">
              <i class="fas fa-bolt"></i>
              <span>Real-time Calculations</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-chart-line"></i>
              <span>Advanced Analytics</span>
            </div>
            <div class="stat-item">
              <i class="fasfa-rocket"></i>
              <span>Performance Optimized</span>
            </div>
          </div>
          <div class="hero-buttons">
            <a href="#rebl-calculator" class="cta-button">
              <i class="fas fa-calculator"></i> Start Calculating
            </a>
            <a href="#calculator-faq" class="cta-button gold">
              <i class="fas fa-question-circle"></i> FAQ & Help
            </a>
            <a href="epoch-rewards.html" class="cta-button">
              <i class="fas fa-gift"></i> View Epoch Rewards
            </a>
            <button onclick="showKeyboardShortcuts()" class="cta-button" style="background: var(--rebel-blue);">
              <i class="fas fa-keyboard"></i> Shortcuts
            </button>
          </div>
          <div class="hero-tip">
            <i class="fas fa-lightbulb"></i>
            <span>Tip: Use Ctrl+Enter to calculate, Ctrl+N to add new batch</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Enhanced Formula Announcement -->
    <section id="formula-announcement">
      <div class="container">
        <div class="announcement-banner calculator-announcement">
          <div class="announcement-header">
            <div class="badge">NEW</div>
            <h3><i class="fas fa-bullhorn"></i> ENHANCED SUSTAINABLE FORMULA (Effective Epoch 15+)</h3>
          </div>
          <div class="formula-display">
            <div class="formula-equation">
              Reward·µ¢ = (WS·µ¢ / ‚àëWS) √ó 3,200,000 √ó Œ≥
            </div>
            <div class="formula-component">
              Œ≥ = MAX(0.4, MIN(1, P/(0.5 √ó CS), CS/‚àëWS))
            </div>
          </div>
          <div class="announcement-details">
            <p><strong>üèõÔ∏è Governance Approved:</strong> This sustainable formula protects the treasury while rewarding active participants.</p>
            <p><strong>üéØ Key Features:</strong> 40% minimum rewards, scales to 100% at 50%+ participation, age bonus capped at 2.4x</p>
          </div>
          <div class="announcement-actions">
            <button onclick="scrollToSection('formula-display-section')" class="quick-action-btn">
              <i class="fas fa-info-circle"></i> Learn More
            </button>
            <button onclick="scrollToSection('gamma-simulator')" class="quick-action-btn">
              <i class="fas fa-sliders-h"></i> Try Simulator
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Enhanced Calculator -->
    <section id="rebl-calculator" class="animate-in">
      <div class="container">
        <div class="section-header-enhanced">
          <h2><i class="fas fa-calculator"></i> Enhanced Sustainable Reward Calculator</h2>
          <div class="section-controls">
            <button onclick="toggleTheme()" class="control-btn" title="Toggle theme">
              <i class="fas fa-palette"></i>
            </button>
            <button onclick="toggleAnimations()" class="control-btn" title="Toggle animations">
              <i class="fas fa-play-circle"></i>
            </button>
            <button onclick="exportResults()" class="control-btn" title="Export results">
              <i class="fas fa-download"></i>
            </button>
          </div>
        </div>
        
        <!-- Enhanced Quick Navigation -->
        <div class="quick-actions-enhanced">
          <button onclick="scrollToSection('token-batches-section')" class="quick-action-btn enhanced">
            <i class="fas fa-layer-group"></i>
            <span>Token Batches</span>
            <div class="quick-action-hint">Add your tokens</div>
          </button>
          <button onclick="scrollToSection('participation-settings')" class="quick-action-btn enhanced">
            <i class="fas fa-sliders-h"></i>
            <span>Participation</span>
            <div class="quick-action-hint">Adjust settings</div>
          </button>
          <button onclick="scrollToSection('gamma-simulator')" class="quick-action-btn enhanced">
            <i class="fas fa-chart-line"></i>
            <span>Gamma Simulator</span>
            <div class="quick-action-hint">What-if scenarios</div>
          </button>
          <button onclick="scrollToSection('calculate-action')" class="quick-action-btn enhanced">
            <i class="fas fa-bolt"></i>
            <span>Calculate</span>
            <div class="quick-action-hint">Get results</div>
          </button>
          <button onclick="showQuickTour()" class="quick-action-btn enhanced" style="background: var(--rebel-purple);">
            <i class="fas fa-play"></i>
            <span>Quick Tour</span>
          </button>
        </div>
        
        <!-- Enhanced Core Parameters -->
        <div class="calculator-parameters enhanced">
          <div class="parameter-grid">
            <div class="parameter-item enhanced">
              <div class="parameter-icon"><i class="fas fa-coins"></i></div>
              <div class="parameter-content">
                <div class="parameter-label">Circulating Supply (CS)</div>
                <div class="parameter-value">499,242,047</div>
                <div class="parameter-description">Total $rebelinux tokens in circulation</div>
                <div class="parameter-status">
                  <i class="fas fa-check-circle"></i> Fixed parameter
                </div>
              </div>
            </div>
            
            <div class="parameter-item enhanced">
              <div class="parameter-icon"><i class="fas fa-piggy-bank"></i></div>
              <div class="parameter-content">
                <div class="parameter-label">Weekly Pool (WERP)</div>
                <div class="parameter-value">3,200,000 $REBL</div>
                <div class="parameter-description">Fixed weekly distribution pool</div>
                <div class="parameter-status">
                  <i class="fas fa-calendar-week"></i> Per epoch
                </div>
              </div>
            </div>
            
            <div class="parameter-item enhanced">
              <div class="parameter-icon"><i class="fas fa-sliders-h"></i></div>
              <div class="parameter-content">
                <div class="parameter-label">Gamma Scale (Œ≥)</div>
                <div id="gammaValueDisplay" class="parameter-value">0.40</div>
                <div class="parameter-description">Dynamic sustainability factor</div>
                <div class="parameter-status">
                  <i class="fas fa-chart-line"></i> Auto-calculated
                </div>
              </div>
            </div>
            
            <div class="parameter-item enhanced">
              <div class="parameter-icon"><i class="fas fa-percentage"></i></div>
              <div class="parameter-content">
                <div class="parameter-label">Age Bonus Rate</div>
                <div class="parameter-value">7% / epoch</div>
                <div class="parameter-description">Max 20 epochs (2.4x multiplier)</div>
                <div class="parameter-status">
                  <i class="fas fa-clock"></i> Time-weighted
                </div>
              </div>
            </div>
          </div>
          
          <div class="parameters-note">
            <i class="fas fa-info-circle"></i>
            <span>All parameters are based on official RebelInuX smart contracts and governance decisions.</span>
          </div>
        </div>

        <!-- Your Token Batches Section -->
        <div class="calculator-section token-batches-section animate-in" id="token-batches-section">
          <div class="section-header">
            <div class="header-content">
              <h3><i class="fas fa-layer-group"></i> Your Token Batches</h3>
              <div class="header-subtitle">
                Add your token batches with age to calculate weighted shares (WS·µ¢)
              </div>
            </div>
            <div class="header-actions">
              <div class="example-buttons">
                <button onclick="loadExampleCase('starter')" class="example-btn enhanced">
                  <i class="fas fa-user-graduate"></i>
                  <span>Starter</span>
                  <div class="example-hint">Small holder</div>
                </button>
                <button onclick="loadExampleCase('investor')" class="example-btn enhanced">
                  <i class="fas fa-chart-line"></i>
                  <span>Investor</span>
                  <div class="example-hint">Medium holder</div>
                </button>
                <button onclick="loadExampleCase('whale')" class="example-btn enhanced">
                  <i class="fas fa-whale"></i>
                  <span>Whale</span>
                  <div class="example-hint">Large holder</div>
                </button>
                <button onclick="loadExampleCase('custom')" class="example-btn enhanced" style="background: var(--rebel-purple);">
                  <i class="fas fa-cog"></i>
                  <span>Custom</span>
                </button>
              </div>
              <div class="header-tip">
                <i class="fas fa-keyboard"></i>
                <span>Press Alt+1/2/3 for quick examples</span>
              </div>
            </div>
          </div>
          
          <div class="section-content">
            <!-- Enhanced Table Actions -->
            <div class="table-actions enhanced">
              <button onclick="addTokenBatch()" class="table-action-btn enhanced">
                <i class="fas fa-plus-circle"></i>
                <span>Add Batch</span>
                <div class="action-hint">Ctrl+N</div>
              </button>
              <button onclick="addTokenBatch('1000000', '5')" class="table-action-btn enhanced">
                <i class="fas fa-bolt"></i>
                <span>Quick 1M</span>
                <div class="action-hint">5 epochs</div>
              </button>
              <button onclick="addTokenBatch('500000', '10')" class="table-action-btn enhanced">
                <i class="fas fa-bolt"></i>
                <span>Quick 500K</span>
                <div class="action-hint">10 epochs</div>
              </button>
              <button onclick="batchDuplicate()" class="table-action-btn enhanced">
                <i class="fas fa-copy"></i>
                <span>Duplicate</span>
              </button>
              <button onclick="batchImport()" class="table-action-btn enhanced">
                <i class="fas fa-file-import"></i>
                <span>Import</span>
              </button>
              <button onclick="clearTokenBatches()" class="table-action-btn enhanced danger">
                <i class="fas fa-trash-alt"></i>
                <span>Clear All</span>
                <div class="action-hint">Ctrl+K</div>
              </button>
            </div>
            
            <!-- Enhanced Table Container -->
            <div class="table-container enhanced">
              <div class="table-header">
                <div class="table-stats">
                  <span id="batchCount">0 batches</span>
                  <span class="divider">‚Ä¢</span>
                  <span id="totalTokensDisplay">0 tokens</span>
                  <span class="divider">‚Ä¢</span>
                  <span id="totalWSDisplay">0 WS</span>
                </div>
                <div class="table-help">
                  <i class="fas fa-question-circle"></i>
                  <div class="tooltip">Click column headers for sorting</div>
                </div>
              </div>
              
              <table id="token-batches-table" class="enhanced-table">
                <thead>
                  <tr>
                    <th onclick="sortTable(0)" class="sortable">
                      <span>$rebelinux Amount</span>
                      <i class="fas fa-sort"></i>
                    </th>
                    <th onclick="sortTable(1)" class="sortable">
                      <span>Age (Epochs)</span>
                      <i class="fas fa-sort"></i>
                    </th>
                    <th onclick="sortTable(2)" class="sortable">
                      <span>Weight Factor</span>
                      <i class="fas fa-sort"></i>
                    </th>
                    <th onclick="sortTable(3)" class="sortable">
                      <span>WS·µ¢ (Weighted Share)</span>
                      <i class="fas fa-sort"></i>
                    </th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Rows will be added dynamically -->
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="5">
                      <div class="table-footer">
                        <div class="footer-hint">
                          <i class="fas fa-info-circle"></i>
                          <span>Age bonus: +7% per epoch (max 20 epochs, 2.4x multiplier)</span>
                        </div>
                        <button onclick="addTokenBatch()" class="footer-add-btn">
                          <i class="fas fa-plus"></i> Add Another Batch
                        </button>
                      </div>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
            
            <!-- User Stats Display (will be populated by JS) -->
            <div id="userStatsContainer"></div>
          </div>
        </div>

        <!-- Enhanced Participation Settings -->
        <div class="calculator-section participation-settings animate-in" id="participation-settings">
          <div class="section-header">
            <div class="header-content">
              <h3><i class="fas fa-users"></i> Participation Settings</h3>
              <div class="header-subtitle">
                Configure participation levels and community metrics
              </div>
            </div>
            <div class="header-badges">
              <div class="badge success">Auto-update</div>
              <div class="badge info">Real-time</div>
            </div>
          </div>
          
          <div class="section-content">
            <!-- Enhanced Auto Update Toggle -->
            <div class="auto-update-toggle enhanced">
              <div class="toggle-header">
                <div class="toggle-label">
                  <i class="fas fa-sync-alt"></i>
                  <span>Auto-update participation based on your tokens</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="autoUpdateToggle" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="toggle-description">
                <i class="fas fa-info-circle"></i>
                <span>When enabled, participation estimates adjust automatically based on your token batches and typical community patterns.</span>
              </div>
              <div class="toggle-stats">
                <div class="stat">
                  <span class="stat-label">Your tokens:</span>
                  <span id="autoUpdateTokens" class="stat-value">0</span>
                </div>
                <div class="stat">
                  <span class="stat-label">Estimated others:</span>
                  <span id="autoUpdateOthers" class="stat-value">0</span>
                </div>
              </div>
            </div>
            
            <!-- Enhanced Slider Group -->
            <div class="slider-group enhanced">
              <div class="slider-container enhanced">
                <div class="slider-header">
                  <div class="slider-title">
                    <i class="fas fa-coins"></i>
                    <span>Total Participating Tokens (P)</span>
                    <div class="help-tooltip">
                      <i class="fas fa-question-circle"></i>
                      <div class="tooltip-text">
                        Total tokens participating in this epoch. Includes your tokens plus estimated other participants.
                        This affects the Gamma Scale Factor (Œ≥) which scales rewards from 40% to 100%.
                      </div>
                    </div>
                  </div>
                  <div class="slider-presets">
                    <button onclick="setSliderPreset('participatingTokens', 50000000)" class="preset-btn">50M</button>
                    <button onclick="setSliderPreset('participatingTokens', 150000000)" class="preset-btn">150M</button>
                    <button onclick="setSliderPreset('participatingTokens', 250000000)" class="preset-btn">250M</button>
                    <button onclick="setSliderPreset('participatingTokens', 400000000)" class="preset-btn">400M</button>
                  </div>
                </div>
                
                <div class="slider-body">
                  <div class="slider-info">
                    <div class="slider-value-display">
                      <input type="text" id="participatingTokensInput" class="value-input enhanced" 
                             value="100,000,000" data-type="participating">
                      <span id="participatingTokensValue" class="slider-value enhanced">100M</span>
                    </div>
                    <div class="slider-percentage">
                      <div class="percentage-bar">
                        <div class="percentage-fill" id="participatingPercentage"></div>
                      </div>
                      <span id="participatingPercentageText">20.0% of CS</span>
                    </div>
                  </div>
                  
                  <div class="slider-wrapper">
                    <input type="range" id="participatingTokens" min="1000000" max="500000000" 
                           step="1000000" value="100000000" class="slider enhanced">
                    <div class="slider-ticks">
                      <span>0%</span>
                      <span>25%</span>
                      <span>50%</span>
                      <span>75%</span>
                      <span>100%</span>
                    </div>
                  </div>
                  
                  <div class="slider-footer">
                    <div class="footer-stat">
                      <span class="stat-label">Your share:</span>
                      <span id="yourTokenShare" class="stat-value">0%</span>
                    </div>
                    <div class="footer-stat">
                      <span class="stat-label">Target (50% CS):</span>
                      <span class="stat-value">249.6M</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="slider-container enhanced">
                <div class="slider-header">
                  <div class="slider-title">
                    <i class="fas fa-chart-bar"></i>
                    <span>‚àëWS (Total Active Weighted Shares)</span>
                    <div class="help-tooltip">
                      <i class="fas fa-question-circle"></i>
                      <div class="tooltip-text">
                        Total weighted shares including age bonuses. This is always ‚â• total participating tokens.
                        Higher age bonuses increase ‚àëWS, which affects the Age Inflation Cap in the Gamma formula.
                      </div>
                    </div>
                  </div>
                  <div class="slider-presets">
                    <button onclick="setSliderPreset('totalWS', 75000000)" class="preset-btn">75M</button>
                    <button onclick="setSliderPreset('totalWS', 200000000)" class="preset-btn">200M</button>
                    <button onclick="setSliderPreset('totalWS', 350000000)" class="preset-btn">350M</button>
                    <button onclick="setSliderPreset('totalWS', 450000000)" class="preset-btn">450M</button>
                  </div>
                </div>
                
                <div class="slider-body">
                  <div class="slider-info">
                    <div class="slider-value-display">
                      <input type="text" id="totalWSInput" class="value-input enhanced" 
                             value="100,000,000" data-type="ws">
                      <span id="totalWSValue" class="slider-value enhanced">100M</span>
                    </div>
                    <div class="slider-percentage">
                      <div class="percentage-bar">
                        <div class="percentage-fill" id="wsPercentage"></div>
                      </div>
                      <span id="wsPercentageText">20.0% of CS</span>
                    </div>
                  </div>
                  
                  <div class="slider-wrapper">
                    <input type="range" id="totalWS" min="1000000" max="500000000" 
                           step="1000000" value="100000000" class="slider enhanced">
                    <div class="slider-ticks">
                      <span>1.0x</span>
                      <span>1.5x</span>
                      <span>2.0x</span>
                      <span>2.4x</span>
                    </div>
                  </div>
                  
                  <div class="slider-footer">
                    <div class="footer-stat">
                      <span class="stat-label">Your WS share:</span>
                      <span id="yourWSShare" class="stat-value">0%</span>
                    </div>
                    <div class="footer-stat">
                      <span class="stat-label">Multiplier:</span>
                      <span id="wsMultiplier" class="stat-value">1.00x</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Enhanced Contribution Display -->
            <div id="contributionContainer" class="contribution-container enhanced">
              <!-- Will be populated by JavaScript -->
            </div>
            
            <!-- Enhanced Gamma Scale Visualization -->
            <div class="gamma-visualization enhanced">
              <div class="visualization-header">
                <h4><i class="fas fa-ruler-combined"></i> Gamma Scale (Œ≥) Visualization</h4>
                <div class="gamma-current">
                  <span class="label">Current Œ≥:</span>
                  <span id="gammaValue" class="gamma-value">0.40</span>
                </div>
              </div>
              
              <div class="gamma-scale enhanced">
                <div class="scale-labels">
                  <span class="scale-label">40% (Floor)</span>
                  <span class="scale-label">50% Participation</span>
                  <span class="scale-label">100% (Max)</span>
                </div>
                <div class="scale-bar">
                  <div class="scale-gradient"></div>
                  <div id="gammaMarker" class="gamma-marker enhanced">
                    <div class="marker-line"></div>
                    <div class="marker-dot"></div>
                    <div class="marker-value">0.40</div>
                  </div>
                  <div class="scale-target" style="left: 50%;">
                    <div class="target-line"></div>
                    <div class="target-label">Target</div>
                  </div>
                </div>
                <div class="scale-legend">
                  <div class="legend-item">
                    <span class="legend-color low"></span>
                    <span>Low (0.4-0.6)</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color medium"></span>
                    <span>Medium (0.6-0.8)</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color high"></span>
                    <span>High (0.8-1.0)</span>
                  </div>
                </div>
              </div>
              
              <!-- Enhanced Gamma Info Panel -->
              <div id="gammaInfoPanel" class="gamma-info-panel enhanced low">
                <div class="gamma-info-header">
                  <i class="fas fa-info-circle"></i>
                  <div class="info-content">
                    <strong>Low Participation (Œ≥ = 0.40)</strong>
                    <div class="info-subtitle">The Gamma Scale is at its minimum</div>
                  </div>
                  <button onclick="showGammaHelp()" class="info-help">
                    <i class="fas fa-question"></i>
                  </button>
                </div>
                <p class="gamma-info-text">
                  Increase participating tokens to unlock higher rewards. The Gamma Scale adjusts rewards from 
                  40% (minimum) to 100% (maximum) based on community participation.
                </p>
                <div class="info-actions">
                  <button onclick="setParticipationPreset('optimal')" class="info-action-btn">
                    <i class="fas fa-bullseye"></i> Set to Optimal
                  </button>
                  <button onclick="scrollToSection('gamma-simulator')" class="info-action-btn">
                    <i class="fas fa-sliders-h"></i> Try Simulator
                  </button>
                </div>
              </div>
              
              <!-- Enhanced Gamma Components -->
              <div class="gamma-components enhanced">
                <div class="component-header">
                  <h5><i class="fas fa-cogs"></i> Gamma Scale Components</h5>
                  <div class="component-help">
                    <i class="fas fa-question-circle"></i>
                    <div class="tooltip-text">
                      Œ≥ = MAX(0.4, MIN(1, P/(0.5√óCS), CS/‚àëWS))
                      <br><br>
                      ‚Ä¢ P/(0.5√óCS): Participation scaling term
                      <br>
                      ‚Ä¢ CS/‚àëWS: Age inflation cap
                      <br>
                      ‚Ä¢ MIN(): Takes the minimum of terms
                      <br>
                      ‚Ä¢ MAX(): Ensures minimum 40% rewards
                    </div>
                  </div>
                </div>
                <div class="components-grid">
                  <div class="gamma-component enhanced">
                    <div class="component-icon">
                      <i class="fas fa-users"></i>
                    </div>
                    <div class="component-content">
                      <div class="component-label">P/(0.5√óCS)</div>
                      <div id="participationTerm" class="component-value">0.40</div>
                      <div class="component-description">Participation Scaling</div>
                    </div>
                  </div>
                  
                  <div class="gamma-component enhanced">
                    <div class="component-icon">
                      <i class="fas fa-balance-scale"></i>
                    </div>
                    <div class="component-content">
                      <div class="component-label">CS/‚àëWS</div>
                      <div id="inflationCap" class="component-value">1.00</div>
                      <div class="component-description">Age Inflation Cap</div>
                    </div>
                  </div>
                  
                  <div class="gamma-component enhanced">
                    <div class="component-icon">
                      <i class="fas fa-compress-alt"></i>
                    </div>
                    <div class="component-content">
                      <div class="component-label">MIN(1, ...)</div>
                      <div id="minTerm" class="component-value">0.40</div>
                      <div class="component-description">Minimum of terms</div>
                    </div>
                  </div>
                  
                  <div class="gamma-component enhanced">
                    <div class="component-icon">
                      <i class="fas fa-expand-alt"></i>
                    </div>
                    <div class="component-content">
                      <div class="component-label">MAX(0.4, ...)</div>
                      <div id="maxTerm" class="component-value">0.40</div>
                      <div class="component-description">Final Gamma Scale</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Enhanced Quick Presets -->
              <div class="preset-buttons enhanced">
                <div class="preset-header">
                  <span>Quick Participation Presets</span>
                  <div class="preset-help">
                    <i class="fas fa-info-circle"></i>
                    <div class="tooltip-text">
                      Apply realistic participation scenarios to see how they affect your rewards.
                      These presets adjust both participating tokens and weighted shares.
                    </div>
                  </div>
                </div>
                <div class="preset-grid">
                  <button onclick="setParticipationPreset('low')" class="preset-btn enhanced">
                    <i class="fas fa-arrow-down"></i>
                    <div class="preset-content">
                      <strong>Low Participation</strong>
                      <span>Conservative estimate</span>
                    </div>
                  </button>
                  <button onclick="setParticipationPreset('medium')" class="preset-btn enhanced">
                    <i class="fas fa-arrows-alt-h"></i>
                    <div class="preset-content">
                      <strong>Medium Participation</strong>
                      <span>Realistic scenario</span>
                    </div>
                  </button>
                  <button onclick="setParticipationPreset('high')" class="preset-btn enhanced">
                    <i class="fas fa-arrow-up"></i>
                    <div class="preset-content">
                      <strong>High Participation</strong>
                      <span>Optimistic scenario</span>
                    </div>
                  </button>
                  <button onclick="setParticipationPreset('optimal')" class="preset-btn enhanced optimal">
                    <i class="fas fa-star"></i>
                    <div class="preset-content">
                      <strong>Optimal (50% CS)</strong>
                      <span>Full gamma unlock</span>
                    </div>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Calculate Button Section -->
        <div class="calculate-action enhanced animate-in" id="calculate-action">
          <div class="calculate-header">
            <h3><i class="fas fa-bolt"></i> Calculate Sustainable Rewards</h3>
            <div class="calculate-stats">
              <div class="stat">
                <i class="fas fa-clock"></i>
                <span>Last calculation: <span id="lastCalculationTime">Never</span></span>
              </div>
              <div class="stat">
                <i class="fas fa-calculator"></i>
                <span>Total calculations: <span id="totalCalculations">0</span></span>
              </div>
            </div>
          </div>
          
          <button onclick="calculateRewards()" class="calculate-btn enhanced" id="calculateButton">
            <div class="btn-content">
              <i class="fas fa-calculator"></i>
              <div class="btn-text">
                <div class="btn-title">CALCULATE SUSTAINABLE REWARDS</div>
                <div class="btn-subtitle">Press Ctrl+Enter for quick calculation</div>
              </div>
            </div>
            <div class="btn-hint">
              <i class="fas fa-mouse-pointer"></i> Click or press Ctrl+Enter
            </div>
          </button>
          
          <div class="calculate-footer">
            <div class="footer-hint">
              <i class="fas fa-info-circle"></i>
              <span>Click to calculate your weekly $REBL rewards based on current settings and token batches</span>
            </div>
            <div class="footer-actions">
              <button onclick="resetCalculator()" class="footer-btn">
                <i class="fas fa-redo"></i> Reset
              </button>
              <button onclick="saveScenario()" class="footer-btn">
                <i class="fas fa-save"></i> Save Scenario
              </button>
            </div>
          </div>
        </div>

        <!-- Enhanced Results Display -->
        <div id="reward-result" class="reward-result enhanced">
          <div class="reward-placeholder">
            <div class="placeholder-icon">
              <i class="fas fa-calculator"></i>
            </div>
            <div class="placeholder-content">
              <h4>Ready to Calculate Rewards!</h4>
              <p>Enter your token batches and click "Calculate Sustainable Rewards" to see your $REBL rewards.</p>
              <div class="placeholder-actions">
                <button onclick="loadExampleCase('starter')" class="placeholder-btn">
                  <i class="fas fa-user-graduate"></i> Load Example
                </button>
                <button onclick="scrollToSection('token-batches-section')" class="placeholder-btn">
                  <i class="fas fa-plus"></i> Add Tokens
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Chart Container -->
        <div class="chart-container enhanced">
          <div class="chart-header">
            <h4><i class="fas fa-chart-pie"></i> Token Batch Distribution</h4>
            <div class="chart-actions">
              <button onclick="toggleChartType()" class="chart-btn">
                <i class="fas fa-exchange-alt"></i> Switch View
              </button>
              <button onclick="downloadChart()" class="chart-btn">
                <i class="fas fa-download"></i> Download
              </button>
              <button onclick="toggleChartLegend()" class="chart-btn">
                <i class="fas fa-list"></i> Legend
              </button>
            </div>
          </div>
          <div class="chart-wrapper">
            <canvas id="rewardChart"></canvas>
            <div id="chartPlaceholder" class="chart-placeholder">
              <div class="placeholder-content">
                <i class="fas fa-chart-pie"></i>
                <p>Your sustainable reward distribution will appear here</p>
                <p class="placeholder-subtext">
                  The chart shows how your weighted shares are distributed across batches
                </p>
              </div>
            </div>
          </div>
          <div class="chart-footer">
            <div class="chart-legend" id="chartLegend">
              <!-- Legend will be populated by JavaScript -->
            </div>
            <div class="chart-stats">
              <div class="stat">
                <span class="stat-label">Total Batches:</span>
                <span id="chartBatchCount" class="stat-value">0</span>
              </div>
              <div class="stat">
                <span class="stat-label">Total WS:</span>
                <span id="chartTotalWS" class="stat-value">0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Gamma Scale Simulator -->
        <div class="calculator-section gamma-simulator enhanced animate-in" id="gamma-simulator">
          <div class="section-header">
            <div class="header-content">
              <h3><i class="fas fa-chart-line"></i> Gamma Scale Simulator</h3>
              <div class="header-subtitle">
                Explore how participation levels affect rewards through what-if scenarios
              </div>
            </div>
            <div class="header-badges">
              <div class="badge interactive">Interactive</div>
              <div class="badge simulation">Simulation</div>
            </div>
          </div>
          
          <div class="section-content">
            <div class="simulator-info enhanced">
              <div class="info-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="info-content">
                <strong>See the Gamma Scale in action!</strong>
                <p>
                  Adjust the sliders to see how the Gamma Scale Factor (Œ≥) adjusts rewards based on community participation. 
                  Watch how reaching 50% participation unlocks higher rewards for everyone!
                </p>
              </div>
            </div>
            
            <!-- Enhanced Simulator Controls -->
            <div class="simulator-controls">
              <div class="control-group">
                <div class="control-header">
                  <div class="control-title">
                    <i class="fas fa-sliders-h"></i>
                    <span>Simulator Settings</span>
                  </div>
                  <div class="control-help">
                    <i class="fas fa-question-circle"></i>
                    <div class="tooltip-text">
                      Adjust these values to simulate different participation scenarios.
                      The Gamma Scale (Œ≥) will update in real-time showing how rewards scale.
                    </div>
                  </div>
                </div>
                
                <div class="slider-group enhanced compact">
                  <div class="slider-container enhanced">
                    <div class="slider-info compact">
                      <div class="slider-label">
                        <i class="fas fa-coins"></i>
                        <span>Participating Tokens (P):</span>
                      </div>
                      <div class="slider-value-display">
                        <input type="text" id="whatIfParticipatingInput" class="value-input compact" 
                               value="100,000,000">
                        <span id="whatIfParticipatingValue" class="slider-value compact">100M</span>
                      </div>
                    </div>
                    <input type="range" id="whatIfParticipating" min="1000000" max="500000000" 
                           step="1000000" value="100000000" class="slider compact">
                  </div>
                  
                  <div class="slider-container enhanced">
                    <div class="slider-info compact">
                      <div class="slider-label">
                        <i class="fas fa-chart-bar"></i>
                        <span>Total Weighted Shares (‚àëWS):</span>
                      </div>
                      <div class="slider-value-display">
                        <input type="text" id="whatIfTotalWSInput" class="value-input compact" 
                               value="100,000,000">
                        <span id="whatIfTotalWSValue" class="slider-value compact">100M</span>
                      </div>
                    </div>
                    <input type="range" id="whatIfTotalWS" min="1000000" max="500000000" 
                           step="1000000" value="100000000" class="slider compact">
                  </div>
                </div>
              </div>
              
              <div class="control-group">
                <div class="control-header">
                  <div class="control-title">
                    <i class="fas fa-bullseye"></i>
                    <span>Target Values</span>
                  </div>
                  <button onclick="copyCurrentToSimulator()" class="control-btn small">
                    <i class="fas fa-copy"></i> Use Current
                  </button>
                </div>
                <div class="target-values">
                  <div class="target-item">
                    <div class="target-label">Target Participation:</div>
                    <div id="targetParticipatingDisplay" class="target-value">249,621,024</div>
                    <div class="target-description">50% of CS</div>
                  </div>
                  <div class="target-item">
                    <div class="target-label">Optimal WS:</div>
                    <div id="optimalWSDisplay" class="target-value">~350,000,000</div>
                    <div class="target-description">Typical with age bonuses</div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Enhanced Simulator Results -->
            <div class="simulator-results enhanced">
              <div class="gamma-result enhanced">
                <div class="result-header">
                  <i class="fas fa-sliders-h"></i>
                  <div class="result-title">
                    <div class="result-label">Gamma Scale Factor</div>
                    <div class="result-subtitle">Œ≥ = MAX(0.4, MIN(1, P/(0.5√óCS), CS/‚àëWS))</div>
                  </div>
                </div>
                <div id="gammaScaleResult" class="gamma-result-value">Œ≥ = 0.40</div>
                <div class="result-scale">
                  <div class="scale-bar">
                    <div class="scale-fill" id="simulatorGammaBar"></div>
                  </div>
                  <div class="scale-labels">
                    <span>0.4</span>
                    <span>0.7</span>
                    <span>1.0</span>
                  </div>
                </div>
              </div>
              
              <div class="effective-distribution enhanced">
                <div class="result-header">
                  <i class="fas fa-gift"></i>
                  <div class="result-title">
                    <div class="result-label">Effective Distribution</div>
                    <div class="result-subtitle">Actual weekly rewards pool</div>
                  </div>
                </div>
                <div id="effectiveDistribution" class="distribution-value">1,280,000 $REBL</div>
                <div class="result-comparison">
                  <div class="comparison-item">
                    <span class="comparison-label">Base pool:</span>
                    <span class="comparison-value">3,200,000</span>
                  </div>
                  <div class="comparison-item">
                    <span class="comparison-label">Effective:</span>
                    <span class="comparison-value highlighted">1,280,000</span>
                  </div>
                </div>
              </div>
              
              <div class="rewards-impact enhanced">
                <div class="result-header">
                  <i class="fas fa-chart-line"></i>
                  <div class="result-title">
                    <div class="result-label">Rewards Impact</div>
                    <div class="result-subtitle">Your potential rewards</div>
                  </div>
                </div>
                <div id="rewardsImpact" class="impact-value">--</div>
                <div class="impact-description">
                  <i class="fas fa-info-circle"></i>
                  <span>Based on your current token batches</span>
                </div>
              </div>
            </div>
            
            <!-- Enhanced Gamma Visualization -->
            <div class="gamma-visualization enhanced">
              <div class="visualization-header">
                <h5><i class="fas fa-ruler-combined"></i> Gamma Scale Visualization</h5>
                <div class="visualization-controls">
                  <button onclick="animateGammaChange()" class="vis-btn">
                    <i class="fas fa-play"></i> Animate
                  </button>
                  <button onclick="resetSimulator()" class="vis-btn">
                    <i class="fas fa-redo"></i> Reset
                  </button>
                </div>
              </div>
              
              <div class="gamma-scale enhanced">
                <div class="scale-bar">
                  <div class="scale-gradient"></div>
                  <div id="whatIfGammaMarker" class="gamma-marker enhanced">
                    <div class="marker-line"></div>
                    <div class="marker-dot"></div>
                    <div class="marker-value">0.40</div>
                  </div>
                  <div class="scale-target" style="left: 50%;">
                    <div class="target-line"></div>
                    <div class="target-label">50% CS</div>
                  </div>
                </div>
                <div class="scale-labels">
                  <span>40% (Floor)</span>
                  <span id="targetParticipation">249.6M (50% CS)</span>
                  <span>100% (Max)</span>
                </div>
              </div>
            </div>
            
            <!-- Enhanced Gamma Breakdown -->
            <div class="gamma-breakdown enhanced">
              <div class="breakdown-header">
                <h5><i class="fas fa-calculator"></i> Gamma Formula Breakdown</h5>
                <div class="breakdown-help">
                  <i class="fas fa-question-circle"></i>
                  <div class="tooltip-text">
                    This shows the step-by-step calculation of the Gamma Scale Factor.
                    Watch how each term affects the final result.
                  </div>
                </div>
              </div>
              <div id="gammaBreakdown" class="breakdown-text">
                Œ≥ = MAX(0.4, MIN(1, 
                <span class="term participation">0.40</span>, 
                <span class="term inflation">1.00</span>)) = 
                <span class="result">0.40</span>
              </div>
              <div class="breakdown-legend">
                <div class="legend-item">
                  <span class="legend-color participation"></span>
                  <span>P/(0.5√óCS) - Participation term</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color inflation"></span>
                  <span>CS/‚àëWS - Inflation cap</span>
                </div>
              </div>
            </div>
            
            <!-- Enhanced Simulator Presets -->
            <div class="simulator-presets enhanced">
              <div class="preset-header">
                <h5><i class="fas fa-prescription-bottle"></i> Quick Simulation Scenarios</h5>
                <div class="preset-help">
                  <i class="fas fa-info-circle"></i>
                  <div class="tooltip-text">
                    Apply different community participation scenarios to see how they affect rewards.
                    Each preset represents a realistic participation level.
                  </div>
                </div>
              </div>
              
              <div class="preset-grid enhanced">
                <button onclick="setSimulatorPreset('current')" class="preset-card">
                  <div class="preset-icon">
                    <i class="fas fa-sync-alt"></i>
                  </div>
                  <div class="preset-content">
                    <strong>Current Settings</strong>
                    <p>Use your current participation values</p>
                  </div>
                  <div class="preset-badge">Quick Apply</div>
                </button>
                
                <button onclick="setSimulatorPreset('optimal')" class="preset-card optimal">
                  <div class="preset-icon">
                    <i class="fas fa-bullseye"></i>
                  </div>
                  <div class="preset-content">
                    <strong>50% Participation</strong>
                    <p>Optimal for full gamma (100%)</p>
                  </div>
                  <div class="preset-badge">Recommended</div>
                </button>
                
                <button onclick="setSimulatorPreset('full')" class="preset-card full">
                  <div class="preset-icon">
                    <i class="fas fa-rocket"></i>
                  </div>
                  <div class="preset-content">
                    <strong>Full Gamma (100%)</strong>
                    <p>Maximum rewards scenario</p>
                  </div>
                  <div class="preset-badge">Max Rewards</div>
                </button>
                
                <button onclick="setSimulatorPreset('custom')" class="preset-card custom">
                  <div class="preset-icon">
                    <i class="fas fa-cog"></i>
                  </div>
                  <div class="preset-content">
                    <strong>Custom Scenario</strong>
                    <p>Enter your own values</p>
                  </div>
                  <div class="preset-badge">Flexible</div>
                </button>
              </div>
            </div>
            
            <div class="simulator-footer">
              <div class="footer-note">
                <i class="fas fa-lightbulb"></i>
                <span>
                  <strong>Tip:</strong> The Gamma Scale protects the treasury during low participation while 
                  rewarding active participants during high participation. It's a win-win for the ecosystem!
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Formula Display Section -->
        <div class="calculator-section formula-display-section enhanced animate-in">
          <div class="section-header">
            <div class="header-content">
              <h3><i class="fas fa-calculator"></i> Sustainable Reward Formula</h3>
              <div class="header-subtitle">
                Understand the mathematical foundation of REBL rewards
              </div>
            </div>
            <div class="header-actions">
              <button onclick="copyFormula()" class="header-btn">
                <i class="fas fa-copy"></i> Copy Formula
              </button>
              <button onclick="printFormula()" class="header-btn">
                <i class="fas fa-print"></i> Print
              </button>
            </div>
          </div>
          
          <div class="section-content">
            <div class="formula-container enhanced">
              <div class="formula-main enhanced">
                Reward·µ¢ = (WS·µ¢ / ‚àëWS) √ó 3,200,000 √ó Œ≥
              </div>
              <div class="formula-component enhanced">
                Œ≥ = MAX(0.4, MIN(1, P/(0.5 √ó CS), CS/‚àëWS))
              </div>
              <div class="formula-legend">
                <div class="legend-item">
                  <span class="legend-symbol">·µ¢</span>
                  <span class="legend-text">Your specific value</span>
                </div>
                <div class="legend-item">
                  <span class="legend-symbol">‚àë</span>
                  <span class="legend-text">Sum of all participants</span>
                </div>
              </div>
            </div>
            
            <div class="formula-explanation enhanced">
              <div class="explanation-section">
                <h5><i class="fas fa-balance-scale"></i> Core Components</h5>
                <div class="explanation-grid">
                  <div class="explanation-item enhanced">
                    <div class="item-icon">
                      <i class="fas fa-weight-hanging"></i>
                    </div>
                    <div class="item-content">
                      <strong>WS·µ¢ (Your Weighted Share)</strong>
                      <p>WS·µ¢ = Œ£[Token Batch √ó (1 + 0.07 √ó min(Age, 20))]</p>
                      <div class="item-hint">
                        Each batch gets 7% weight boost per epoch (max 20 epochs)
                      </div>
                    </div>
                  </div>
                  
                  <div class="explanation-item enhanced">
                    <div class="item-icon">
                      <i class="fas fa-users"></i>
                    </div>
                    <div class="item-content">
                      <strong>‚àëWS (Total Active Weighted Shares)</strong>
                      <p>Sum of all participants' weighted shares</p>
                      <div class="item-hint">
                        Includes age bonuses from all participating tokens
                      </div>
                    </div>
                  </div>
                  
                  <div class="explanation-item enhanced">
                    <div class="item-icon">
                      <i class="fas fa-coins"></i>
                    </div>
                    <div class="item-content">
                      <strong>P (Participating Tokens)</strong>
                      <p>Total raw tokens participating in the epoch</p>
                      <div class="item-hint">
                        Raw token amount (not weighted by age)
                      </div>
                    </div>
                  </div>
                  
                  <div class="explanation-item enhanced">
                    <div class="item-icon">
                      <i class="fas fa-box"></i>
                    </div>
                    <div class="item-content">
                      <strong>CS (Circulating Supply)</strong>
                      <p>Total $rebelinux tokens in circulation (499,242,047)</p>
                      <div class="item-hint">
                        Fixed parameter based on tokenomics
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="explanation-section">
                <h5><i class="fas fa-sliders-h"></i> Gamma Scale Factor (Œ≥)</h5>
                <div class="gamma-explanation">
                  <div class="gamma-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                      <strong>Participation Scaling: P/(0.5 √ó CS)</strong>
                      <p>Scales linearly from 0 to 2.0 as participation approaches 100% of CS</p>
                    </div>
                  </div>
                  
                  <div class="gamma-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                      <strong>Age Inflation Cap: CS/‚àëWS</strong>
                      <p>Prevents excessive rewards from age bonuses (minimum 0.4167)</p>
                    </div>
                  </div>
                  
                  <div class="gamma-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                      <strong>Minimum: MIN(1, ...)</strong>
                      <p>Takes the smallest value (caps at 1.0 maximum)</p>
                    </div>
                  </div>
                  
                  <div class="gamma-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                      <strong>Maximum: MAX(0.4, ...)</strong>
                      <p>Ensures minimum 40% rewards even with low participation</p>
                    </div>
                  </div>
                </div>
                
                <div class="gamma-ranges">
                  <div class="range-item low">
                    <div class="range-label">Low (0.4-0.6)</div>
                    <div class="range-description">Less than 30% participation</div>
                  </div>
                  <div class="range-item medium">
                    <div class="range-label">Medium (0.6-0.8)</div>
                    <div class="range-description">30-40% participation</div>
                  </div>
                  <div class="range-item high">
                    <div class="range-label">High (0.8-1.0)</div>
                    <div class="range-description">40-50%+ participation</div>
                  </div>
                </div>
              </div>
              
              <div class="explanation-section">
                <h5><i class="fas fa-chart-line"></i> Practical Examples</h5>
                <div class="examples-grid">
                  <div class="example-item">
                    <div class="example-title">Low Participation</div>
                    <div class="example-data">
                      <div class="data-item">
                        <span>P = 100M (20% CS)</span>
                        <span>‚àëWS = 120M</span>
                      </div>
                      <div class="data-result">
                        Œ≥ = MAX(0.4, MIN(1, 0.4, 4.16)) = 0.40
                      </div>
                      <div class="data-reward">
                        Effective pool: 1,280,000 $REBL (40%)
                      </div>
                    </div>
                  </div>
                  
                  <div class="example-item">
                    <div class="example-title">Optimal Participation</div>
                    <div class="example-data">
                      <div class="data-item">
                        <span>P = 250M (50% CS)</span>
                        <span>‚àëWS = 350M</span>
                      </div>
                      <div class="data-result">
                        Œ≥ = MAX(0.4, MIN(1, 1.0, 1.43)) = 1.00
                      </div>
                      <div class="data-reward">
                        Effective pool: 3,200,000 $REBL (100%)
                      </div>
                    </div>
                  </div>
                  
                  <div class="example-item">
                    <div class="example-title">High Age Bonus</div>
                    <div class="example-data">
                      <div class="data-item">
                        <span>P = 300M (60% CS)</span>
                        <span>‚àëWS = 600M</span>
                      </div>
                      <div class="data-result">
                        Œ≥ = MAX(0.4, MIN(1, 1.2, 0.83)) = 0.83
                      </div>
                      <div class="data-reward">
                        Effective pool: 2,656,000 $REBL (83%)
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Enhanced Calculator FAQ -->
    <section id="calculator-faq" class="animate-in">
      <div class="container">
        <div class="section-header-enhanced">
          <h2><i class="fas fa-question-circle"></i> Enhanced Calculator FAQ</h2>
          <div class="section-subtitle">
            Everything you need to know about using the enhanced REBL calculator
          </div>
        </div>
        
        <div class="content-card enhanced">
          <div class="faq-grid enhanced">
            <div class="faq-item enhanced">
              <div class="faq-header">
                <h4><i class="fas fa-sliders-h"></i> What is the Gamma Scale Factor (Œ≥)?</h4>
                <div class="faq-badge">Core Concept</div>
              </div>
              <p>
                The Gamma Scale Factor (Œ≥) is a dynamic multiplier that adjusts rewards based on participation levels. 
                It scales from 40% (minimum) to 100% (maximum) using the formula:
              </p>
              <div class="faq-formula">
                Œ≥ = MAX(0.4, MIN(1, P/(0.5√óCS), CS/‚àëWS))
              </div>
              <p>
                This protects the treasury during low participation while rewarding active participants during high participation.
              </p>
              <div class="faq-hint">
                <i class="fas fa-lightbulb"></i>
                <span>Œ≥ reaches 100% when 50%+ of tokens participate with reasonable age bonuses</span>
              </div>
            </div>
            
            <div class="faq-item enhanced">
              <div class="faq-header">
                <h4><i class="fas fa-calculator"></i> How is WS·µ¢ calculated?</h4>
                <div class="faq-badge">Calculation</div>
              </div>
              <p>
                Your Weighted Share (WS·µ¢) is calculated per batch and summed:
              </p>
              <div class="faq-formula">
                WS·µ¢ = Token Amount √ó (1 + 0.07 √ó min(Epoch Age, 20))
              </div>
              <p>
                Each batch gets a 7% weight boost per epoch, capping at 2.4x after 20 epochs. This encourages long-term holding.
              </p>
              <div class="faq-example">
                <strong>Example:</strong> 100K tokens, 10 epochs ‚Üí WS = 100,000 √ó (1 + 0.07√ó10) = 170,000
              </div>
            </div>
            
            <div class="faq-item enhanced">
              <div class="faq-header">
                <h4><i class="fas fa-chart-line"></i> Why do my estimates change with participation?</h4>
                <div class="faq-badge">Dynamic</div>
              </div>
              <p>
                The formula is proportional: Your share = Your WS·µ¢ √∑ Total WS. As more participants join:
              </p>
              <ul class="faq-list">
                <li>Total WS increases (denominator grows)</li>
                <li>Your percentage share decreases</li>
                <li>But Œ≥ may increase, boosting overall rewards</li>
              </ul>
              <p>
                This creates a balance where community growth benefits everyone through higher Œ≥.
              </p>
            </div>
            
            <div class="faq-item enhanced">
              <div class="faq-header">
                <h4><i class="fas fa-balance-scale"></i> What's the difference between P and ‚àëWS?</h4>
                <div class="faq-badge">Key Distinction</div>
              </div>
              <p>
                <strong>P (Participating Tokens):</strong> Raw token count participating in the epoch.
              </p>
              <p>
                <strong>‚àëWS (Total Weighted Shares):</strong> P multiplied by age bonuses (1-2.4x).
              </p>
              <div class="faq-comparison">
                <div class="comparison-item">
                  <div class="comparison-title">P</div>
                  <div class="comparison-value">100M tokens</div>
                </div>
                <div class="comparison-item">
                  <div class="comparison-title">‚àëWS</div>
                  <div class="comparison-value">120-240M shares</div>
                </div>
              </div>
              <p>
                ‚àëWS is always ‚â• P, typically 1.2-2.4x larger due to age bonuses.
              </p>
            </div>
            
            <div class="faq-item enhanced">
              <div class="faq-header">
                <h4><i class="fas fa-check-circle"></i> Is this calculator accurate?</h4>
                <div class="faq-badge">Accuracy</div>
              </div>
              <p>
                This calculator uses the exact formula from RebelInuX smart contracts. Results are estimates because:
              </p>
              <ul class="faq-list">
                <li>Actual participation (P) varies each epoch</li>
                <li>Age bonuses depend on individual holding periods</li>
                <li>Final Œ≥ is calculated from on-chain data</li>
              </ul>
              <p>
                For precise rewards, check the official epoch rewards page after each epoch completion.
              </p>
            </div>
            
            <div class="faq-item enhanced">
              <div class="faq-header">
                <h4><i class="fas fa-sync-alt"></i> How often should I recalculate?</h4>
                <div class="faq-badge">Best Practices</div>
              </div>
              <p>
                Recalculate when:
              </p>
              <div class="faq-timeline">
                <div class="timeline-item">
                  <div class="timeline-marker">
                    <i class="fas fa-shopping-cart"></i>
                  </div>
                  <div class="timeline-content">
                    <strong>Buying/Selling Tokens</strong>
                    <span>Your token amount changes</span>
                  </div>
                </div>
                <div class="timeline-item">
                  <div class="timeline-marker">
                    <i class="fas fa-calendar-week"></i>
                  </div>
                  <div class="timeline-content">
                    <strong>Epoch Completion</strong>
                    <span>Age increases by 1 epoch</span>
                  </div>
                </div>
                <div class="timeline-item">
                  <div class="timeline-marker">
                    <i class="fas fa-users"></i>
                  </div>
                  <div class="timeline-content">
                    <strong>Participation Changes</strong>
                    <span>Community activity shifts</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="faq-item enhanced">
              <div class="faq-header">
                <h4><i class="fas fa-gift"></i> How do I actually claim rewards?</h4>
                <div class="faq-badge">Practical</div>
              </div>
              <p>
                To claim rewards, you need:
              </p>
              <ol class="faq-list numbered">
                <li>$rebelinux tokens in your wallet</li>
                <li>Active Rebel Key NFT (for weekly claiming)</li>
                <li>Connect to the official RebelInuX interface</li>
              </ol>
              <p>
                <a href="epoch-rewards.html#how-to-claim" class="claim-link enhanced">
                  <i class="fas fa-external-link-alt"></i> See step-by-step claiming instructions ‚Üí
                </a>
              </p>
              <div class="faq-hint">
                <i class="fas fa-clock"></i>
                <span>Weekly claiming window opens after each epoch completion</span>
              </div>
            </div>
            
            <div class="faq-item enhanced">
              <div class="faq-header">
                <h4><i class="fas fa-exclamation-triangle"></i> What happens if participation is low?</h4>
                <div class="faq-badge">Edge Cases</div>
              </div>
              <p>
                Low participation triggers the Œ≥ floor (40%). This mechanism:
              </p>
              <ul class="faq-list">
                <li>Protects the treasury from excessive outflows</li>
                <li>Still rewards active participants proportionally</li>
                <li>Encourages community growth for higher rewards</li>
              </ul>
              <p>
                Even at 40%, you receive fair rewards based on your share of the active pool.
              </p>
              <div class="faq-note">
                <i class="fas fa-shield-alt"></i>
                <span>The 40% floor ensures sustainable rewards regardless of participation levels</span>
              </div>
            </div>
          </div>
          
          <div class="faq-footer">
            <div class="footer-content">
              <i class="fas fa-comments"></i>
              <div class="footer-text">
                <strong>Still have questions?</strong>
                <span>Join the RebelInuX community for support and discussions.</span>
              </div>
            </div>
            <div class="footer-actions">
              <a href="https://t.me/RebelInuX" class="footer-btn" target="_blank">
                <i class="fab fa-telegram"></i> Telegram
              </a>
              <a href="https://discord.gg/rebelinux" class="footer-btn" target="_blank">
                <i class="fab fa-discord"></i> Discord
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Enhanced Related Pages -->
    <section id="related-pages" class="animate-in">
      <div class="container">
        <div class="section-header-enhanced">
          <h2>Related Resources</h2>
          <div class="section-subtitle">
            Explore more RebelInuX tools and resources
          </div>
        </div>
        
        <div class="related-grid enhanced">
          <!-- Epoch Rewards -->
          <a href="epoch-rewards.html" class="related-card enhanced rewards-card">
            <div class="card-badge">
              <i class="fas fa-gift"></i>
              <span>Rewards</span>
            </div>
            <div class="related-icon">
              <i class="fas fa-gift"></i>
            </div>
            <div class="related-content">
              <h3>Epoch Rewards</h3>
              <p>Weekly $REBL distribution system with claiming interface and historical data</p>
              <div class="related-features">
                <span class="feature">Live Rewards</span>
                <span class="feature">Claiming Guide</span>
                <span class="feature">History</span>
              </div>
            </div>
            <div class="related-arrow">
              <span>Explore Rewards</span>
              <i class="fas fa-arrow-right"></i>
            </div>
          </a>
          
          <!-- Tokenomics -->
          <a href="tokenomics.html" class="related-card enhanced tokenomics-card">
            <div class="card-badge">
              <i class="fas fa-chart-pie"></i>
              <span>Economics</span>
            </div>
            <div class="related-icon">
              <i class="fas fa-chart-pie"></i>
            </div>
            <div class="related-content">
              <h3>Tokenomics</h3>
              <p>$REBL distribution, vesting schedules, and economic model details</p>
              <div class="related-features">
                <span class="feature">Distribution</span>
                <span class="feature">Vesting</span>
                <span class="feature">Model</span>
              </div>
            </div>
            <div class="related-arrow">
              <span>View Economics</span>
              <i class="fas fa-arrow-right"></i>
            </div>
          </a>
          
          <!-- Governance -->
          <a href="governance.html" class="related-card enhanced governance-card">
            <div class="card-badge">
              <i class="fas fa-vote-yea"></i>
              <span>Governance</span>
            </div>
            <div class="related-icon">
              <i class="fas fa-vote-yea"></i>
            </div>
            <div class="related-content">
              <h3>Governance</h3>
              <p>DAO structure, community voting, and proposal system</p>
              <div class="related-features">
                <span class="feature">Voting</span>
                <span class="feature">Proposals</span>
                <span class="feature">DAO</span>
              </div>
            </div>
            <div class="related-arrow">
              <span>Start Voting</span>
              <i class="fas fa-arrow-right"></i>
            </div>
          </a>
          
          <!-- Documentation -->
          <a href="https://docs.rebelinux.fun" class="related-card enhanced docs-card" target="_blank">
            <div class="card-badge">
              <i class="fas fa-book"></i>
              <span>Documentation</span>
            </div>
            <div class="related-icon">
              <i class="fas fa-book"></i>
            </div>
            <div class="related-content">
              <h3>Documentation</h3>
              <p>Complete technical documentation and developer resources</p>
              <div class="related-features">
                <span class="feature">API</span>
                <span class="feature">Guides</span>
                <span class="feature">Technical</span>
              </div>
            </div>
            <div class="related-arrow">
              <span>Read Docs</span>
              <i class="fas fa-external-link-alt"></i>
            </div>
          </a>
        </div>
      </div>
    </section>
    
  </main>
  
  <!-- Footer will be inserted here by JavaScript -->
  <div id="footer-container"></div>
  
  <!-- Enhanced JavaScript Includes -->
  <script src="js/includes.js"></script>
  <script src="js/common.js"></script>
  
  <!-- Enhanced Calculator JavaScript -->
  <script src="js/rebl-calculator.js"></script>
  
  <!-- PWA Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }).catch(function(error) {
        console.log('ServiceWorker registration failed: ', error);
      });
    }
  </script>
  
  <!-- Additional inline scripts for enhanced features -->
  <script>
    // Helper functions for enhanced features
    function scrollToSection(sectionId) {
      const element = document.getElementById(sectionId);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
    
    function toggleTheme() {
      const themes = ['dark', 'light', 'auto'];
      const currentIndex = themes.indexOf(calculatorState.theme);
      calculatorState.theme = themes[(currentIndex + 1) % themes.length];
      localStorage.setItem('rebl-calculator-theme', calculatorState.theme);
      applyTheme();
      showToast(`Theme: ${calculatorState.theme}`, 'info');
    }
    
    function toggleAnimations() {
      calculatorState.animationsEnabled = !calculatorState.animationsEnabled;
      document.body.classList.toggle('reduced-motion', !calculatorState.animationsEnabled);
      showToast(`Animations: ${calculatorState.animationsEnabled ? 'enabled' : 'disabled'}`, 'info');
    }
    
    function showKeyboardShortcuts() {
      const shortcuts = `
        <div class="shortcuts-modal">
          <h3><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h3>
          <div class="shortcuts-grid">
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>Enter</kbd>
              <span>Calculate rewards</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>N</kbd>
              <span>Add new batch</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>K</kbd>
              <span>Clear all batches</span>
            </div>
            <div class="shortcut-item">
              <kbd>Alt</kbd> + <kbd>1</kbd>
              <span>Starter example</span>
            </div>
            <div class="shortcut-item">
              <kbd>Alt</kbd> + <kbd>2</kbd>
              <span>Investor example</span>
            </div>
            <div class="shortcut-item">
              <kbd>Alt</kbd> + <kbd>3</kbd>
              <span>Whale example</span>
            </div>
            <div class="shortcut-item">
              <kbd>Esc</kbd>
              <span>Blur input</span>
            </div>
          </div>
          <button onclick="this.closest('.shortcuts-modal').remove()" class="close-btn">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
      `;
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = shortcuts;
      document.body.appendChild(modal);
    }
    
    function showQuickTour() {
      const steps = [
        {
          element: '#token-batches-section',
          title: 'Token Batches',
          content: 'Start by adding your token batches here. Each batch can have different amounts and ages.'
        },
        {
          element: '#participation-settings',
          title: 'Participation Settings',
          content: 'Configure community participation levels. Use auto-update for realistic estimates.'
        },
        {
          element: '#calculate-action',
          title: 'Calculate Rewards',
          content: 'Click here to calculate your weekly $REBL rewards based on current settings.'
        },
        {
          element: '#gamma-simulator',
          title: 'Gamma Simulator',
          content: 'Explore how different participation levels affect rewards through what-if scenarios.'
        }
      ];
      
      let currentStep = 0;
      
      function showStep(stepIndex) {
        const step = steps[stepIndex];
        const element = document.querySelector(step.element);
        
        if (element) {
          element.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
          // Highlight element
          element.classList.add('tour-highlight');
          setTimeout(() => element.classList.remove('tour-highlight'), 2000);
          
          // Show tooltip
          const tooltip = document.createElement('div');
          tooltip.className = 'tour-tooltip';
          tooltip.innerHTML = `
            <div class="tour-header">
              <h4>${step.title} (${stepIndex + 1}/${steps.length})</h4>
              <button onclick="this.closest('.tour-tooltip').remove()" class="tour-close">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="tour-content">${step.content}</div>
            <div class="tour-actions">
              ${stepIndex > 0 ? '<button onclick="showStep(' + (stepIndex - 1) + ')" class="tour-btn">Previous</button>' : ''}
              ${stepIndex < steps.length - 1 ? '<button onclick="showStep(' + (stepIndex + 1) + ')" class="tour-btn primary">Next</button>' : ''}
              ${stepIndex === steps.length - 1 ? '<button onclick="this.closest(\'.tour-tooltip\').remove()" class="tour-btn primary">Finish Tour</button>' : ''}
            </div>
          `;
          
          // Remove existing tooltip
          document.querySelectorAll('.tour-tooltip').forEach(t => t.remove());
          
          // Position tooltip
          const rect = element.getBoundingClientRect();
          tooltip.style.position = 'fixed';
          tooltip.style.top = (rect.top + window.scrollY - 150) + 'px';
          tooltip.style.left = (rect.left + window.scrollX) + 'px';
          
          document.body.appendChild(tooltip);
        }
      }
      
      showStep(0);
    }
    
    function setSliderPreset(sliderId, value) {
      const slider = document.getElementById(sliderId);
      const input = document.getElementById(sliderId + 'Input');
      
      if (slider && input) {
        slider.value = value;
        input.value = formatNumber(value, false);
        
        // Trigger events
        slider.dispatchEvent(new Event('input'));
        input.dispatchEvent(new Event('input'));
        
        showToast(`Set ${sliderId} to ${formatNumber(value)}`, 'info');
      }
    }
    
    function copyCurrentToSimulator() {
      const participatingInput = document.getElementById('whatIfParticipatingInput');
      const totalWSInput = document.getElementById('whatIfTotalWSInput');
      
      if (participatingInput && totalWSInput) {
        participatingInput.value = formatNumber(calculatorState.currentParticipatingTokens, false);
        totalWSInput.value = formatNumber(calculatorState.currentTotalWS, false);
        
        participatingInput.dispatchEvent(new Event('input'));
        totalWSInput.dispatchEvent(new Event('input'));
        
        showToast('Copied current settings to simulator', 'success');
      }
    }
    
    function animateGammaChange() {
      const slider = document.getElementById('whatIfParticipating');
      const targetValue = 250000000; // 50% CS
      const currentValue = parseInt(slider.value);
      const step = (targetValue - currentValue) / 20;
      
      let i = 0;
      const interval = setInterval(() => {
        if (i >= 20) {
          clearInterval(interval);
          return;
        }
        
        const newValue = currentValue + (step * i);
        slider.value = newValue;
        slider.dispatchEvent(new Event('input'));
        i++;
      }, 100);
    }
    
    function resetSimulator() {
      document.getElementById('whatIfParticipatingInput').value = '100,000,000';
      document.getElementById('whatIfTotalWSInput').value = '100,000,000';
      
      document.getElementById('whatIfParticipatingInput').dispatchEvent(new Event('input'));
      document.getElementById('whatIfTotalWSInput').dispatchEvent(new Event('input'));
      
      showToast('Simulator reset to defaults', 'info');
    }
    
    function copyFormula() {
      const formula = 'Reward·µ¢ = (WS·µ¢ / ‚àëWS) √ó 3,200,000 √ó Œ≥\nŒ≥ = MAX(0.4, MIN(1, P/(0.5 √ó CS), CS/‚àëWS))';
      
      navigator.clipboard.writeText(formula).then(() => {
        showToast('Formula copied to clipboard', 'success');
      });
    }
    
    function printFormula() {
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <html>
          <head>
            <title>REBL Reward Formula</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h1 { color: #D4A76A; }
              .formula { font-family: 'Courier New', monospace; font-size: 18px; margin: 20px 0; }
            </style>
          </head>
          <body>
            <h1>REBL Sustainable Reward Formula</h1>
            <div class="formula">Reward·µ¢ = (WS·µ¢ / ‚àëWS) √ó 3,200,000 √ó Œ≥</div>
            <div class="formula">Œ≥ = MAX(0.4, MIN(1, P/(0.5 √ó CS), CS/‚àëWS))</div>
            <p>Printed from REBL Calculator at ${new Date().toLocaleString()}</p>
          </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }
    
    function toggleChartType() {
      if (rewardChart) {
        const newType = rewardChart.config.type === 'doughnut' ? 'pie' : 'doughnut';
        rewardChart.config.type = newType;
        rewardChart.update();
        showToast(`Switched to ${newType} chart`, 'info');
      }
    }
    
    function downloadChart() {
      if (rewardChart) {
        const link = document.createElement('a');
        link.download = `rebl-chart-${new Date().toISOString().split('T')[0]}.png`;
        link.href = rewardChart.toBase64Image();
        link.click();
        showToast('Chart downloaded', 'success');
      }
    }
    
    function toggleChartLegend() {
      const legend = document.getElementById('chartLegend');
      if (legend) {
        legend.style.display = legend.style.display === 'none' ? 'block' : 'none';
      }
    }
    
    function batchDuplicate() {
      const rows = document.querySelectorAll('#token-batches-table tbody tr');
      if (rows.length > 0) {
        const lastRow = rows[rows.length - 1];
        const amount = lastRow.querySelector('.batch-amount').value;
        const age = lastRow.querySelector('.batch-age').value;
        
        if (amount && amount !== '0') {
          addTokenBatch(amount, age);
          showToast('Duplicated last batch', 'success');
        } else {
          showToast('Last batch is empty', 'warning');
        }
      }
    }
    
    function batchImport() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json,.csv,.txt';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const data = JSON.parse(e.target.result);
              if (data.batches && Array.isArray(data.batches)) {
                clearTokenBatches();
                setTimeout(() => {
                  data.batches.forEach(batch => {
                    addTokenBatch(batch.amount, batch.age);
                  });
                  showToast(`Imported ${data.batches.length} batches`, 'success');
                }, 500);
              }
            } catch (error) {
              showToast('Invalid file format', 'error');
            }
          };
          reader.readAsText(file);
        }
      };
      input.click();
    }
    
    function saveScenario() {
      const scenario = {
        name: prompt('Enter scenario name:', `Scenario ${new Date().toLocaleDateString()}`),
        timestamp: new Date().toISOString(),
        batches: [],
        settings: {
          participatingTokens: calculatorState.currentParticipatingTokens,
          totalWS: calculatorState.currentTotalWS,
          autoUpdate: calculatorState.autoUpdateParticipation
        }
      };
      
      if (scenario.name) {
        const rows = document.querySelectorAll('#token-batches-table tbody tr');
        rows.forEach(row => {
          const amount = parseFloat(row.querySelector('.batch-amount').value.replace(/,/g, '')) || 0;
          const age = parseFloat(row.querySelector('.batch-age').value) || 0;
          if (amount > 0) {
            scenario.batches.push({ amount, age });
          }
        });
        
        localStorage.setItem(`rebl-scenario-${Date.now()}`, JSON.stringify(scenario));
        showToast(`Scenario "${scenario.name}" saved`, 'success');
      }
    }
    
    function resetCalculator() {
      if (confirm('Reset calculator to initial state?')) {
        clearTokenBatches();
        calculatorState.currentParticipatingTokens = 100000000;
        calculatorState.currentTotalWS = 100000000;
        calculatorState.autoUpdateParticipation = true;
        
        document.getElementById('autoUpdateToggle').checked = true;
        document.getElementById('participatingTokensInput').value = '100,000,000';
        document.getElementById('totalWSInput').value = '100,000,000';
        
        updateParticipationUI();
        showToast('Calculator reset', 'info');
      }
    }
    
    function sortTable(columnIndex) {
      const table = document.getElementById('token-batches-table');
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      
      // Toggle sort direction
      const isAscending = table.dataset.sortColumn === String(columnIndex) ? 
                         table.dataset.sortDirection !== 'asc' : true;
      
      rows.sort((a, b) => {
        const aVal = getCellValue(a, columnIndex);
        const bVal = getCellValue(b, columnIndex);
        
        if (isNaN(aVal) || isNaN(bVal)) {
          return isAscending ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
        }
        
        return isAscending ? aVal - bVal : bVal - aVal;
      });
      
      // Update sort indicators
      table.querySelectorAll('th i.fas').forEach(icon => {
        icon.className = 'fas fa-sort';
      });
      
      const headerIcon = table.querySelectorAll('th')[columnIndex].querySelector('i');
      headerIcon.className = isAscending ? 'fas fa-sort-up' : 'fas fa-sort-down';
      
      // Reorder rows
      rows.forEach(row => tbody.appendChild(row));
      
      // Save sort state
      table.dataset.sortColumn = columnIndex;
      table.dataset.sortDirection = isAscending ? 'asc' : 'desc';
    }
    
    function getCellValue(row, columnIndex) {
      const cell = row.cells[columnIndex];
      if (columnIndex === 0) { // Amount
        const input = cell.querySelector('input');
        return parseFloat(input.value.replace(/,/g, '')) || 0;
      } else if (columnIndex === 1) { // Age
        const input = cell.querySelector('input');
        return parseFloat(input.value) || 0;
      } else if (columnIndex === 2) { // Factor
        return parseFloat(cell.querySelector('.factor-value').textContent) || 0;
      } else if (columnIndex === 3) { // WS
        return parseFloat(cell.querySelector('.ws-value').textContent.replace(/,/g, '')) || 0;
      }
      return '';
    }
    
    function showGammaHelp() {
      const helpText = `
        <div class="gamma-help">
          <h3><i class="fas fa-sliders-h"></i> Understanding Gamma Scale (Œ≥)</h3>
          
          <div class="help-section">
            <h4>What is Gamma Scale?</h4>
            <p>The Gamma Scale Factor (Œ≥) is a dynamic multiplier that adjusts rewards based on participation levels. It ensures:</p>
            <ul>
              <li><strong>Minimum 40% rewards</strong> even with low participation (treasury protection)</li>
              <li><strong>Scales to 100%</strong> when 50%+ of tokens participate (community reward)</li>
              <li><strong>Balances fairness</strong> between new and long-term holders</li>
            </ul>
          </div>
          
          <div class="help-section">
            <h4>How it's Calculated</h4>
            <div class="formula">Œ≥ = MAX(0.4, MIN(1, P/(0.5√óCS), CS/‚àëWS))</div>
            <p>Where:</p>
            <ul>
              <li><strong>P/(0.5√óCS)</strong> - Participation scaling (0 to 2.0)</li>
              <li><strong>CS/‚àëWS</strong> - Age inflation cap (prevents excessive age bonuses)</li>
              <li><strong>MIN(1, ...)</strong> - Caps at 100% maximum</li>
              <li><strong>MAX(0.4, ...)</strong> - Ensures 40% minimum</li>
            </ul>
          </div>
          
          <div class="help-section">
            <h4>Why it Matters</h4>
            <p>Gamma Scale creates a win-win situation:</p>
            <ul>
              <li><strong>For the Treasury:</strong> Protected during low participation</li>
              <li><strong>For Holders:</strong> Rewarded during high participation</li>
              <li><strong>For the Community:</strong> Incentivizes growth and participation</li>
            </ul>
          </div>
          
          <button onclick="this.closest('.gamma-help').remove()" class="close-btn">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
      `;
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = helpText;
      document.body.appendChild(modal);
    }
    
    // Initialize additional features
    document.addEventListener('DOMContentLoaded', function() {
      // Add performance stats
      updatePerformanceStats();
      
      // Add keyboard shortcut hint
      setTimeout(() => {
        const hint = document.createElement('div');
        hint.className = 'keyboard-hint';
        hint.innerHTML = `
          <i class="fas fa-keyboard"></i>
          <span>Press <kbd>Ctrl+Enter</kbd> to calculate</span>
          <button onclick="this.parentElement.remove()" class="hint-close">
            <i class="fas fa-times"></i>
          </button>
        `;
        document.body.appendChild(hint);
        
        setTimeout(() => {
          if (hint.parentElement) {
            hint.style.opacity = '0';
            setTimeout(() => hint.remove(), 300);
          }
        }, 5000);
      }, 3000);
    });
    
    function updatePerformanceStats() {
      setInterval(() => {
        document.getElementById('lastCalculationTime').textContent = 
          calculatorState.lastCalculationTime ? 
          calculatorState.lastCalculationTime.toLocaleTimeString() : 
          'Never';
        
        document.getElementById('totalCalculations').textContent = 
          performanceMetrics.calculations;
      }, 1000);
    }
    
    // Add custom example case
    window.loadExampleCase = function(type) {
      if (type === 'custom') {
        const amount = prompt('Enter total token amount (e.g., 1000000):', '1000000');
        const age = prompt('Enter average age in epochs (0-20):', '5');
        
        if (amount && age) {
          clearTokenBatches();
          setTimeout(() => {
            addTokenBatch(amount, age);
            showToast(`Custom example loaded: ${formatNumber(amount)} tokens, ${age} epochs`, 'success');
          }, 500);
        }
        return;
      }
      
      // Existing example cases...
      clearTokenBatches();
      
      setTimeout(() => {
        switch(type) {
          case 'starter':
            addTokenBatch('50000', '3');
            addTokenBatch('100000', '8');
            addTokenBatch('25000', '1');
            break;
          case 'investor':
            addTokenBatch('500000', '5');
            addTokenBatch('1000000', '10');
            addTokenBatch('750000', '15');
            addTokenBatch('250000', '2');
            break;
          case 'whale':
            addTokenBatch('2000000', '8');
            addTokenBatch('3000000', '12');
            addTokenBatch('5000000', '18');
            addTokenBatch('1000000', '20');
            addTokenBatch('500000', '6');
            break;
        }
        
        showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} example loaded`, 'success');
      }, 500);
    };
    
    // Enhanced setParticipationPreset function
    window.setParticipationPreset = function(type) {
      let participating, totalWS;
      
      switch(type) {
        case 'low':
          participating = 50000000;
          totalWS = 75000000;
          break;
        case 'medium':
          participating = 150000000;
          totalWS = 200000000;
          break;
        case 'high':
          participating = 300000000;
          totalWS = 400000000;
          break;
        case 'optimal':
          participating = 249621024;
          totalWS = 350000000;
          break;
        default:
          return;
      }
      
      calculatorState.currentParticipatingTokens = participating;
      calculatorState.currentTotalWS = totalWS;
      
      document.getElementById('participatingTokensInput').value = formatNumber(participating, false);
      document.getElementById('participatingTokens').value = participating;
      document.getElementById('totalWSInput').value = formatNumber(totalWS, false);
      document.getElementById('totalWS').value = totalWS;
      
      updateParticipationDisplay();
      calculateRewards();
      
      showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} participation preset applied`, 'info');
    };
    
    // Enhanced setSimulatorPreset function
    window.setSimulatorPreset = function(type) {
      let participating, totalWS;
      
      switch(type) {
        case 'current':
          participating = calculatorState.currentParticipatingTokens;
          totalWS = calculatorState.currentTotalWS;
          break;
        case 'optimal':
          participating = 249621024;
          totalWS = 350000000;
          break;
        case 'full':
          participating = 400000000;
          totalWS = 450000000;
          break;
        case 'custom':
          participating = prompt('Enter participating tokens:', '100000000');
          totalWS = prompt('Enter total weighted shares:', '100000000');
          if (!participating || !totalWS) return;
          participating = parseInt(participating);
          totalWS = parseInt(totalWS);
          break;
        default:
          return;
      }
      
      document.getElementById('whatIfParticipatingInput').value = formatNumber(participating, false);
      document.getElementById('whatIfParticipating').value = participating;
      document.getElementById('whatIfTotalWSInput').value = formatNumber(totalWS, false);
      document.getElementById('whatIfTotalWS').value = totalWS;
      
      updateWhatIfGamma();
      
      showToast(`Simulator: ${type} scenario`, 'info');
    };
    
    // Make formatNumber available globally
    window.formatNumber = formatNumber;
  </script>
</body>
</html>
